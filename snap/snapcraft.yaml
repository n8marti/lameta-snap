name: lameta-unofficial
title: laMETA
version: 2.0.19-beta
base: core18 # highest available for nodejs/yarn
summary: Lameta is a metadata tool to help with organising collections of files.
description: |
  Lameta is mainly aimed at collections made in the course of documenting language, music, and other cultural expressions.

  Lameta greatly simplifies management of collections and makes the archiving process straightforward and painless for field workers. 

  Hatton, John, Gary Holton, Mandana Seyfeddinipur, Nick Thieberger. 2021. Lameta [software] https://github.com/onset/laMETA/releases
grade: devel
confinement: devmode
architectures:
  - amd64
apps:
  lameta-unofficial:
    extensions: [gnome-3-34]
    command: lameta
    plugs:
      - audio-playback
      - home
      - network
      - udisks2

parts:
  lameta:
    plugin: nodejs
    # Node version from package.json: engines.node
    nodejs-version: '16.20.0'
    nodejs-yarn-version: v1.22.19 # from .yarnrc; needs 'v' in front to work
    # source: https://github.com/onset/lameta/archive/refs/tags/v2.1.2-alpha.tar.gz
    source: https://github.com/onset/lameta/archive/refs/tags/v2.0.19-beta.tar.gz
    override-pull: |
      # # Install yarn.
      # curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
      # echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
      # apt-get update
      # apt-get install yarn
      snapcraftctl pull
    build-packages:
      - curl
      # - nodejs # doesn't install correct version
      # - yarn # doesn't seem to work correctly (ERROR: There are no scenarios...)
    override-build: |
      yarn
      yarn dev
      yarn package
